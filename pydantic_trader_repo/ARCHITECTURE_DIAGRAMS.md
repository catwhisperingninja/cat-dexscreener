# Pydantic-Trader Architecture Diagrams

## 1. System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PYDANTIC-TRADER SYSTEM ARCHITECTURE                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚                          USER / DEPLOYMENT LAYER                          â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Entry Points:                                                       â”‚ â”‚
â”‚  â”‚  â€¢ poetry run python uni_handler.py    (PRIMARY)                    â”‚ â”‚
â”‚  â”‚  â€¢ python pydantic_trader_main.py      (SECONDARY)                  â”‚ â”‚
â”‚  â”‚  â€¢ python ask_claude_trading.py        (AI INTERACTION)             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â†“                                         â”‚
â”‚                                                                             â”‚
â”‚                         APPLICATION CORE LAYER                            â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Arbitrage Module (/arbitrage)                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚  â”‚
â”‚  â”‚  â”‚ Integration  â”‚  Scanner     â”‚  Engine      â”‚                    â”‚  â”‚
â”‚  â”‚  â”‚ (orchestra)  â”‚ (data fetch) â”‚ (detection)  â”‚                    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚  â”‚
â”‚  â”‚  â”‚ Detectors    â”‚ Volatility   â”‚ Fallback     â”‚                    â”‚  â”‚
â”‚  â”‚  â”‚ (opp types)  â”‚ Monitor      â”‚ (dexscreen)  â”‚                    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“              â†“              â†“                  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Execution Layer (/execution)        Profit Layer (/profit)         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚ TradeExecutor               â”‚   â”‚ ProfitabilityCalculator  â”‚     â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ ensure_mcp_connected()    â”‚   â”‚ â€¢ calculate_gas_cost()   â”‚     â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ execute_swap_via_mcp()    â”‚   â”‚ â€¢ is_trade_profitable()  â”‚     â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ _encode_swap()            â”‚   â”‚ â€¢ slippage_adjustment()  â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  Signal Layer (/signals)             Price Layer (/price)            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚ EnhancedSignalGenerator     â”‚   â”‚ PriceOracle              â”‚     â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ MACD analysis             â”‚   â”‚ â€¢ Token conversion       â”‚     â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Multi-timeframe trends    â”‚   â”‚ â€¢ USD calculation        â”‚     â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Confidence scoring        â”‚   â”‚ (Dune-only per rules)    â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â†“                                        â”‚
â”‚                                                                             â”‚
â”‚                      DATA & INTEGRATION LAYER                             â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Dune Analytics (/dune)          MCP Integration (/mcp)             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚ DuneClient               â”‚   â”‚ MCPHTTPClient (PRIMARY)     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ execute(query)         â”‚   â”‚ â€¢ connect() to gateway      â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ QueryBase classes      â”‚   â”‚ â€¢ execute(server, method)   â”‚    â”‚  â”‚
â”‚  â”‚  â”‚                          â”‚   â”‚ â€¢ close()                   â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚ RealtimePriceFetcher     â”‚   â”‚ MCPHTTPGateway              â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Fresh data only        â”‚   â”‚ â€¢ FastAPI HTTP interface    â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Fallback strategy      â”‚   â”‚ â€¢ /health endpoint          â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ NO CACHING             â”‚   â”‚ â€¢ /execute/{server} endpointâ”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚ StaleDataValidator       â”‚   â”‚ MCPProtocol                 â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Duplicate detection    â”‚   â”‚ â€¢ Stdio implementation      â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Price validation       â”‚   â”‚ â€¢ Direct MCP connections    â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Timestamp freshness    â”‚   â”‚ (fallback to stdio)         â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚                      INFRASTRUCTURE LAYER                                 â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Web3 Core (/core)                   Utilities (/utils)             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ Web3Initializer              â”‚   â”‚ Logging (app_logger)       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Alchemy RPC connection     â”‚   â”‚ â€¢ SIGNAL level (25)        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Contract ABI loading       â”‚   â”‚ â€¢ Emoji prefixes           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ geth_poa_middleware        â”‚   â”‚ â€¢ Signal filtering         â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ MarketDataProvider           â”‚   â”‚ PrecisionMath              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Token/pool data            â”‚   â”‚ â€¢ WeiConverter             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Contract queries           â”‚   â”‚ â€¢ Decimal arithmetic       â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚                                     â”‚ SepoliaConfig              â”‚  â”‚  â”‚
â”‚  â”‚  Flashbots (/flashbots)             â”‚ â€¢ Environment loading      â”‚  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â€¢ Chain configuration      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ FlashbotsExecutor            â”‚   â”‚ â€¢ Token addresses          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Bundle simulation          â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Bundle execution           â”‚                                   â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ MEV protection             â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ TokenAmount (Precision)    â”‚  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â€¢ from_wei()               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ ContractEncoder              â”‚   â”‚ â€¢ from_decimal()           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Real ABI encoding          â”‚   â”‚ â€¢ format() with decimals   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ No hardcoded values        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
                                    â†“
                                    â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         EXTERNAL SYSTEMS (Depend on Connectivity)          â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                                            â”‚
        â”‚  Dune Analytics API      MCP Servers       Blockchain     â”‚
        â”‚  â€¢ 25K quota/month       â€¢ uniswap-pools   â€¢ Alchemy RPC  â”‚
        â”‚  â€¢ Query execution       â€¢ uniswap-trader  â€¢ Sepolia      â”‚
        â”‚  â€¢ Fresh data fetch      â€¢ crypto-indicat  â€¢ Gas prices   â”‚
        â”‚                          â€¢ Smithery Cloud  â€¢ Execution    â”‚
        â”‚                          â€¢ HTTP Gateway    â”‚
        â”‚                                            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Data Flow: Trading Opportunity Detection & Execution

```
TIME â†’

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STARTUP (One-time initialization)                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  1. Load .env â†’ SepoliaConfig                                          â”‚
â”‚  2. Init Web3Initializer â†’ Alchemy RPC connection                      â”‚
â”‚  3. Init DuneClient â†’ DUNE_API_KEY validation                          â”‚
â”‚  4. Init Account â†’ WALLET_PRIVATE_KEY                                  â”‚
â”‚  5. Init ArbitrageIntegration                                          â”‚
â”‚  6. Init TradeExecutor                                                 â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ MAIN LOOP (Every 120 seconds)                       â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                                                      â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚ PHASE 1: PRICE DISCOVERY                    â”‚   â”‚
        â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
        â”‚  â”‚                                              â”‚   â”‚
        â”‚  â”‚  Get ETH Price (Fresh Dune)                 â”‚   â”‚
        â”‚  â”‚  Query 5447367 â†’ DuneClient.execute()       â”‚   â”‚
        â”‚  â”‚          â†“                                   â”‚   â”‚
        â”‚  â”‚  Price = $2,345.67 USD                      â”‚   â”‚
        â”‚  â”‚          â†“                                   â”‚   â”‚
        â”‚  â”‚  Log: ğŸ“Š PRICE UPDATE                       â”‚   â”‚
        â”‚  â”‚                                              â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚              â†“                                      â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚ PHASE 2: OPPORTUNITY DISCOVERY              â”‚   â”‚
        â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
        â”‚  â”‚                                              â”‚   â”‚
        â”‚  â”‚  Get Cross-DEX Data (Fresh Dune)            â”‚   â”‚
        â”‚  â”‚  Query 5444709 â†’ ArbitrageScanner.py        â”‚   â”‚
        â”‚  â”‚          â†“                                   â”‚   â”‚
        â”‚  â”‚  Validate Freshness (StaleDataValidator)   â”‚   â”‚
        â”‚  â”‚  â”œâ”€ Check: duplicate tx_hash? âŒ            â”‚   â”‚
        â”‚  â”‚  â”œâ”€ Check: identical prices? âŒ             â”‚   â”‚
        â”‚  â”‚  â””â”€ Check: timestamp < 5min? âœ…             â”‚   â”‚
        â”‚  â”‚          â†“                                   â”‚   â”‚
        â”‚  â”‚  [IF FAILS â†’ Dexscreener Fallback]          â”‚   â”‚
        â”‚  â”‚          â†“                                   â”‚   â”‚
        â”‚  â”‚  Found: Buy ETH on Uniswap @ $2,344         â”‚   â”‚
        â”‚  â”‚        Sell ETH on SushiSwap @ $2,346       â”‚   â”‚
        â”‚  â”‚  Spread: $2 (0.09%)                         â”‚   â”‚
        â”‚  â”‚                                              â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚              â†“                                      â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚ PHASE 3: PROFITABILITY VALIDATION           â”‚   â”‚
        â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
        â”‚  â”‚                                              â”‚   â”‚
        â”‚  â”‚  Calculate Costs:                           â”‚   â”‚
        â”‚  â”‚  â”œâ”€ Gas Cost = (4 gwei * 300k) / 10^9      â”‚   â”‚
        â”‚  â”‚  â”‚           = 0.0012 ETH ($2.82)          â”‚   â”‚
        â”‚  â”‚  â””â”€ Slippage = 1% on $2,345 = $23.45       â”‚   â”‚
        â”‚  â”‚                                              â”‚   â”‚
        â”‚  â”‚  Calculate Profit:                          â”‚   â”‚
        â”‚  â”‚  â”œâ”€ Gross = (0.1 ETH * $2) = $0.20        â”‚   â”‚
        â”‚  â”‚  â”œâ”€ Net = $0.20 - $2.82 - $23.45          â”‚   â”‚
        â”‚  â”‚  â”‚     = -$25.07 âŒ                        â”‚   â”‚
        â”‚  â”‚  â”‚                                          â”‚   â”‚
        â”‚  â”‚  â””â”€ Is Profitable? NO                       â”‚   â”‚
        â”‚  â”‚      Threshold: $4.23 (gas * 1.5)          â”‚   â”‚
        â”‚  â”‚      Actual: -$25.07                        â”‚   â”‚
        â”‚  â”‚                                              â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚              â†“                                      â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚ PHASE 4: EXECUTION (IF PROFITABLE)          â”‚   â”‚
        â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
        â”‚  â”‚                                              â”‚   â”‚
        â”‚  â”‚  TradeExecutor.execute_swap_via_mcp()       â”‚   â”‚
        â”‚  â”‚  â”œâ”€ Connect to MCP gateway                  â”‚   â”‚
        â”‚  â”‚  â”œâ”€ Call uniswap-trader.executeSwap()       â”‚   â”‚
        â”‚  â”‚  â”‚  {                                        â”‚   â”‚
        â”‚  â”‚  â”‚    tokenIn: "NATIVE",                    â”‚   â”‚
        â”‚  â”‚  â”‚    tokenOut: "0xA0b8...",                â”‚   â”‚
        â”‚  â”‚  â”‚    amountIn: "100000000000000000",       â”‚   â”‚
        â”‚  â”‚  â”‚    chainId: 1                            â”‚   â”‚
        â”‚  â”‚  â”‚  }                                        â”‚   â”‚
        â”‚  â”‚  â”œâ”€ [SMITHERY returns JSON string]          â”‚   â”‚
        â”‚  â”‚  â”œâ”€ json.loads(response)                    â”‚   â”‚
        â”‚  â”‚  â””â”€ Log: ğŸš€ SWAP EXECUTED                  â”‚   â”‚
        â”‚  â”‚                                              â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚              â†“                                      â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚  â”‚ PHASE 5: STATUS UPDATE                      â”‚   â”‚
        â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
        â”‚  â”‚                                              â”‚   â”‚
        â”‚  â”‚  Log periodic status:                       â”‚   â”‚
        â”‚  â”‚  ğŸ¤– STATUS: Scanning complete              â”‚   â”‚
        â”‚  â”‚  ğŸ“Š Opportunities found: 0 profitable        â”‚   â”‚
        â”‚  â”‚  ğŸ’° Total profit: $0.00                     â”‚   â”‚
        â”‚  â”‚                                              â”‚   â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚                                                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
                    [Wait 120s]
                        â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Repeat main loop (2/4)   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. MCP Integration: Server Connections & Fallback Chain

```
CLIENT REQUEST
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MCPHTTPClient.execute(server, method, params)           â”‚
â”‚  gateway_url: http://127.0.0.1:8888                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HTTP Gateway (FastAPI)                                  â”‚
â”‚  GET /health â†’ Server list & status                      â”‚
â”‚  POST /execute/{server} â†’ Route to MCP server            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MCP Server Type Detection                               â”‚
â”‚                                                          â”‚
â”‚  TYPE A: Local MCP (stdio)                              â”‚
â”‚  â”œâ”€ crypto-indicators-mcp âœ…                            â”‚
â”‚  â”œâ”€ git-mcp-server âœ…                                  â”‚
â”‚  â””â”€ [requires MCPProtocol]                             â”‚
â”‚                                                          â”‚
â”‚  TYPE B: Smithery Cloud (JSON strings)                 â”‚
â”‚  â”œâ”€ uniswap-trader âŒ (504 error)                      â”‚
â”‚  â”œâ”€ cat-dexscreener âŒ (504 error)                     â”‚
â”‚  â””â”€ [requires json.loads() parsing]                    â”‚
â”‚                                                          â”‚
â”‚  TYPE C: Hybrid Gateway (recommended)                   â”‚
â”‚  â””â”€ [transparent handling]                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FALLBACK CHAIN FOR PRICE DATA                          â”‚
â”‚                                                          â”‚
â”‚  TIER 1: Dune Analytics (ALWAYS FIRST)                 â”‚
â”‚  â”œâ”€ Execute Query ID (fresh only)                       â”‚
â”‚  â”œâ”€ Result: SUCCESS â†’ Return data                       â”‚
â”‚  â””â”€ Result: 0 rows â†’ Continue to TIER 2                â”‚
â”‚       â†“                                                  â”‚
â”‚  TIER 2: Smithery dexscreener MCP                       â”‚
â”‚  â”œâ”€ Call: get_pair(tokenIn/tokenOut)                   â”‚
â”‚  â”œâ”€ Result: SUCCESS â†’ Return data                       â”‚
â”‚  â””â”€ Result: 504 error â†’ Continue to TIER 3             â”‚
â”‚       â†“                                                  â”‚
â”‚  TIER 3: Local Alchemy MCP + Chainlink                 â”‚
â”‚  â”œâ”€ Query: Chainlink ETH/USD oracle                    â”‚
â”‚  â”œâ”€ Contract: 0x5f4eC3Df9cbd43714FE2740f5E3616155c... â”‚
â”‚  â”œâ”€ Result: SUCCESS â†’ Return data                       â”‚
â”‚  â””â”€ Result: Connection error â†’ Continue to TIER 4      â”‚
â”‚       â†“                                                  â”‚
â”‚  TIER 4: Emergency CoinGecko API                        â”‚
â”‚  â”œâ”€ Call: GET /simple/price?ids=ethereum               â”‚
â”‚  â”œâ”€ Result: SUCCESS â†’ Return data (EMERGENCY ONLY)     â”‚
â”‚  â””â”€ Result: Network error â†’ COMPLETE FAILURE           â”‚
â”‚                                                          â”‚
â”‚  ACTIVE STATUS: TIER 1 + TIER 4 only (2/4)            â”‚
â”‚  TIER 2 & 3: Offline (Smithery down, Alchemy build)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Module Dependency Graph

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DEPENDENCY HIERARCHY                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ENTRY POINTS                                                   â”‚
â”‚  â”œâ”€ uni_handler.py                                             â”‚
â”‚  â”œâ”€ pydantic_trader_main.py                                    â”‚
â”‚  â””â”€ ask_claude_trading.py                                      â”‚
â”‚                                                                  â”‚
â”‚              â†“ imports                                           â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ UniswapTrading (pydantic_trader_main.py)                â”‚  â”‚
â”‚  â”‚ â€¢ Central orchestrator                                   â”‚  â”‚
â”‚  â”‚ â€¢ Manages all subsystems                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â”œâ”€ Web3Initializer                                       â”‚
â”‚       â”œâ”€ DuneClient                                            â”‚
â”‚       â”œâ”€ Account (wallet)                                      â”‚
â”‚       â”œâ”€ ArbitrageIntegration                                  â”‚
â”‚       â”œâ”€ PriceOracle                                           â”‚
â”‚       â””â”€ TokenAmount                                           â”‚
â”‚                                                                  â”‚
â”‚              â†“ imports                                           â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ArbitrageIntegration (orchestration)                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â”œâ”€ ArbitrageScanner                                      â”‚
â”‚       â”‚  â”œâ”€ DuneClient (data fetch)                           â”‚
â”‚       â”‚  â”œâ”€ DexscreenerFallback                              â”‚
â”‚       â”‚  â”‚  â”œâ”€ RealtimePriceFetcher                          â”‚
â”‚       â”‚  â”‚  â””â”€ StaleDataValidator                            â”‚
â”‚       â”‚  â””â”€ Alchemy SDK (if needed)                          â”‚
â”‚       â”‚                                                         â”‚
â”‚       â”œâ”€ VolatilityMonitor                                    â”‚
â”‚       â”‚  â””â”€ Price data (from ArbitrageScanner)              â”‚
â”‚       â”‚                                                         â”‚
â”‚       â”œâ”€ OpportunityDetectors                                â”‚
â”‚       â”‚  â”œâ”€ MCPClients (AAVE, Uniswap)                      â”‚
â”‚       â”‚  â””â”€ Market data                                       â”‚
â”‚       â”‚                                                         â”‚
â”‚       â”œâ”€ ProfitabilityCalculator                            â”‚
â”‚       â”‚  â”œâ”€ TokenAmount                                       â”‚
â”‚       â”‚  â””â”€ Gas constants                                     â”‚
â”‚       â”‚                                                         â”‚
â”‚       â””â”€ TradeExecutor                                        â”‚
â”‚           â”œâ”€ MCPHTTPClient                                    â”‚
â”‚           â”‚  â”œâ”€ MCPHTTPGateway                               â”‚
â”‚           â”‚  â””â”€ MCPProtocol (fallback)                       â”‚
â”‚           â”œâ”€ ContractEncoder                                 â”‚
â”‚           â””â”€ FlashbotsExecutor (optional)                    â”‚
â”‚                                                                  â”‚
â”‚              â†“ imports                                           â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ UTILITY LAYERS                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â”œâ”€ PrecisionMath (WeiConverter, TokenAmount)            â”‚
â”‚       â”œâ”€ Logging (app_logger)                                â”‚
â”‚       â”œâ”€ SepoliaConfig                                        â”‚
â”‚       â”œâ”€ TokenConfig                                          â”‚
â”‚       â”œâ”€ MarketDataProvider                                   â”‚
â”‚       â”œâ”€ EnhancedSignalGenerator                              â”‚
â”‚       â””â”€ BalanceHandler                                        â”‚
â”‚                                                                  â”‚
â”‚              â†“ imports                                           â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ EXTERNAL SYSTEMS                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â”œâ”€ Dune Analytics API (HTTP)                            â”‚
â”‚       â”œâ”€ MCP Servers (HTTP gateway)                          â”‚
â”‚       â”‚  â”œâ”€ uniswap-pools                                    â”‚
â”‚       â”‚  â”œâ”€ uniswap-trader (Smithery)                       â”‚
â”‚       â”‚  â”œâ”€ crypto-indicators                                â”‚
â”‚       â”‚  â””â”€ Chainlink (via Alchemy)                         â”‚
â”‚       â”œâ”€ Alchemy RPC (Sepolia/Mainnet)                      â”‚
â”‚       â”œâ”€ Flashbots Network (optional)                        â”‚
â”‚       â””â”€ CoinGecko API (emergency)                          â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Profit Calculation Pipeline

```
INPUT: Detected Arbitrage Opportunity
       â”œâ”€ Token: ETH
       â”œâ”€ Buy DEX: Uniswap
       â”œâ”€ Buy Price: $2,344.00
       â”œâ”€ Sell DEX: SushiSwap
       â”œâ”€ Sell Price: $2,346.00
       â”œâ”€ Available Balance: 1.0 ETH
       â””â”€ Network: Sepolia

        â†“ ProfitabilityCalculator.is_trade_profitable()

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: Calculate Gross Profit                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Spread = Sell Price - Buy Price                         â”‚
â”‚         = $2,346.00 - $2,344.00                          â”‚
â”‚         = $2.00 per ETH                                  â”‚
â”‚                                                            â”‚
â”‚  Amount = min(balance, max_trade_eth)                    â”‚
â”‚         = min(1.0, 0.01)  [Fund protection]             â”‚
â”‚         = 0.01 ETH                                       â”‚
â”‚                                                            â”‚
â”‚  Gross Profit = Amount Ã— Spread                          â”‚
â”‚               = 0.01 Ã— $2.00                            â”‚
â”‚               = $0.02 USD                                â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Calculate Slippage Adjustment                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Slippage Percentage = 1% [SLIPPAGE_PERCENTAGE]          â”‚
â”‚                                                            â”‚
â”‚  On BUY: Receive less                                    â”‚
â”‚  Amount Received = 0.01 Ã— (1 - 0.01)                    â”‚
â”‚                 = 0.01 Ã— 0.99                           â”‚
â”‚                 = 0.0099 ETH                             â”‚
â”‚                                                            â”‚
â”‚  On SELL: Pay more                                       â”‚
â”‚  Amount Needed = 0.0099 Ã— (1 + 0.01)                    â”‚
â”‚               = 0.0099 Ã— 1.01                           â”‚
â”‚               = 0.009999 ETH                             â”‚
â”‚                                                            â”‚
â”‚  Adjusted Spread = $2.00 Ã— (1 - 0.01 - 0.01)           â”‚
â”‚                 = $2.00 Ã— 0.98                          â”‚
â”‚                 = $1.96 USD per ETH                     â”‚
â”‚                                                            â”‚
â”‚  Adjusted Gross = 0.01 Ã— $1.96                          â”‚
â”‚                = $0.0196 USD                             â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Calculate Gas Costs                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Gas Price = 4 gwei [SEPOLIA_GAS_PRICE_GWEI]            â”‚
â”‚  Gas Limit = 300,000 units [DEFAULT_GAS_LIMIT]          â”‚
â”‚                                                            â”‚
â”‚  Total Gas Wei = Gas Price Ã— Gas Limit Ã— 10^9           â”‚
â”‚                = 4 Ã— 300,000 Ã— 10^9                     â”‚
â”‚                = 1,200,000,000,000,000 Wei              â”‚
â”‚                = 0.0012 ETH                              â”‚
â”‚                = 0.0012 Ã— $2,345.00                      â”‚
â”‚                = $2.81 USD                               â”‚
â”‚                                                            â”‚
â”‚  [BREAKDOWN]                                             â”‚
â”‚  â€¢ Each buy: ~0.0006 ETH gas                            â”‚
â”‚  â€¢ Each sell: ~0.0006 ETH gas                           â”‚
â”‚  â€¢ Total: ~0.0012 ETH (~$2.81 at current price)         â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: Calculate Net Profit                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Net Profit = Adjusted Gross - Gas Cost                  â”‚
â”‚             = $0.0196 - $2.81                            â”‚
â”‚             = -$2.79 USD                                 â”‚
â”‚                                                            â”‚
â”‚  Net Profit in ETH = -0.0012 ETH                        â”‚
â”‚                                                            â”‚
â”‚  [MARGIN ANALYSIS]                                       â”‚
â”‚  â”œâ”€ Gross: $0.02                                        â”‚
â”‚  â”œâ”€ Slippage: -$0.0004 (0.02%)                         â”‚
â”‚  â”œâ”€ Gas: -$2.81 (99%)                                  â”‚
â”‚  â””â”€ Net: -$2.79 âŒ NOT PROFITABLE                       â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: Profitability Check                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Minimum Threshold = Gas Cost Ã— 1.5 [PROFIT_MULTIPLIER] â”‚
â”‚                   = $2.81 Ã— 1.5                         â”‚
â”‚                   = $4.22 USD                            â”‚
â”‚                                                            â”‚
â”‚  Is Profitable?                                          â”‚
â”‚  Net Profit (-$2.79) > Threshold ($4.22)?              â”‚
â”‚  -$2.79 > $4.22? NO âŒ                                  â”‚
â”‚                                                            â”‚
â”‚  Decision: REJECT TRADE                                 â”‚
â”‚                                                            â”‚
â”‚  [EXPLANATION]                                           â”‚
â”‚  The gross spread ($2) is too small compared to         â”‚
â”‚  gas costs ($2.81). Even with perfect execution,       â”‚
â”‚  the trade loses $2.79. Need spread of $4.22+ to       â”‚
â”‚  be profitable.                                          â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

OUTPUT: is_trade_profitable() â†’ False, not executed
```

---

## 6. Fallback Data Hierarchy

```
SCENARIO: Arbitrage Scanning Starts

Request: get_cross_dex_prices()
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TIER 1: DUNE ANALYTICS (PRIMARY)    â”‚
â”‚ â”œâ”€ Query ID: 5444709                â”‚
â”‚ â”œâ”€ Type: Fresh execution only       â”‚
â”‚ â”œâ”€ Method: dune_client.execute()    â”‚
â”‚ â”œâ”€ Validates: No cache, no mock     â”‚
â”‚ â””â”€ Result: 15 rows in 2.3s âœ…       â”‚
â”‚    â”œâ”€ UniswapV3: ETH=$2,345.00      â”‚
â”‚    â”œâ”€ SushiSwap: ETH=$2,346.50      â”‚
â”‚    â””â”€ Curve: ETH=$2,344.75          â”‚
â”‚                                      â”‚
â”‚ [Continue with fresh data]           â”‚
â”‚ Status: SUCCESS â†’ Return data        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
[Process opportunities from TIER 1]

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ALTERNATE SCENARIO: Dune Returns 0 Rows

Request: get_cross_dex_prices()
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TIER 1: DUNE ANALYTICS (PRIMARY)    â”‚
â”‚ â”œâ”€ Query ID: 5444709                â”‚
â”‚ â”œâ”€ Result: 0 rows in 1.2s           â”‚
â”‚ â”œâ”€ Reason: No recent trades         â”‚
â”‚ â””â”€ Action: Try fallback âš ï¸           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TIER 2: DEXSCREENER MCP             â”‚
â”‚ â”œâ”€ Server: Smithery Cloud           â”‚
â”‚ â”œâ”€ Endpoint: cat-dexscreener        â”‚
â”‚ â”œâ”€ Method: get_pair()               â”‚
â”‚ â”œâ”€ Status: HTTP 504 âŒ              â”‚
â”‚ â”‚  â””â”€ Smithery.ai infrastructure    â”‚
â”‚ â”‚     is temporarily down           â”‚
â”‚ â””â”€ Action: Try next tier âš ï¸          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TIER 3: ALCHEMY MCP + CHAINLINK     â”‚
â”‚ â”œâ”€ Server: Local Alchemy MCP        â”‚
â”‚ â”œâ”€ Oracle: Chainlink ETH/USD        â”‚
â”‚ â”œâ”€ Contract: 0x5f4eC3Df9cbd43...   â”‚
â”‚ â”œâ”€ Status: Build required âš ï¸         â”‚
â”‚ â”‚  â””â”€ TypeScript build not done     â”‚
â”‚ â”‚     in local environment          â”‚
â”‚ â””â”€ Action: Try next tier âš ï¸          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TIER 4: COINGECKO API (EMERGENCY)   â”‚
â”‚ â”œâ”€ Server: Free public API          â”‚
â”‚ â”œâ”€ Endpoint: /simple/price          â”‚
â”‚ â”œâ”€ Rate limit: 2 requests/sec       â”‚
â”‚ â”œâ”€ Status: ACTIVE âœ…                â”‚
â”‚ â”‚  â””â”€ GET /api/v3/simple/price      â”‚
â”‚ â”‚     ?ids=ethereum&vs_currencies=  â”‚
â”‚ â”‚     usd&include_24hr_vol=true     â”‚
â”‚ â”œâ”€ Result: {ethereum: 2345.67}      â”‚
â”‚ â””â”€ âš ï¸  LIMITATION: Single price only â”‚
â”‚    (No arbitrage opportunity data)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
[Use single ETH price as last resort]
Status: FALLBACK COMPLETE (Limited data)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

COMPLETE FAILURE SCENARIO:

All tiers fail
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NO DATA AVAILABLE                   â”‚
â”‚                                      â”‚
â”‚ âŒ Cannot detect opportunities      â”‚
â”‚ âŒ Cannot execute trades            â”‚
â”‚ âš ï¸  Status: Offline mode            â”‚
â”‚                                      â”‚
â”‚ Action:                             â”‚
â”‚ 1. Log critical alert               â”‚
â”‚ 2. Retry in 120 seconds             â”‚
â”‚ 3. Check logs for root cause        â”‚
â”‚ 4. Verify API keys and connectivity â”‚
â”‚ 5. Monitor Dune/Smithery status     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Precision Math Flow: Wei Conversions

```
INPUT: Transaction Amount
  "amount_in": "1500000000000000000"  (Wei string from user)

        â†“ WeiConverter processing

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: String â†’ Integer Conversion                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Input: "1500000000000000000" (string)                â”‚
â”‚  int("1500000000000000000")                           â”‚
â”‚  â†’  1500000000000000000 (integer)                     â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Create Decimal with Precision                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  from decimal import Decimal, getcontext              â”‚
â”‚  getcontext().prec = 50  [High precision]             â”‚
â”‚                                                         â”‚
â”‚  Decimal(1500000000000000000)                         â”‚
â”‚  â†’  Decimal('1500000000000000000')                    â”‚
â”‚                                                         â”‚
â”‚  Advantage: NO FLOATING POINT ERRORS                  â”‚
â”‚  âŒ WRONG: float(1500000000000000000) Ã— 10**-18      â”‚
â”‚             â†’ 1.5 with precision loss                  â”‚
â”‚  âœ… CORRECT: Decimal handles exact precision          â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Apply Token Decimals                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  ETH Decimals = 18                                    â”‚
â”‚  USDC Decimals = 6                                   â”‚
â”‚                                                         â”‚
â”‚  ETH Wei â†’ ETH Display:                              â”‚
â”‚  Decimal(1500000000000000000) / Decimal(10**18)      â”‚
â”‚  â†’ Decimal('1.5')                                     â”‚
â”‚                                                         â”‚
â”‚  USDC Wei â†’ USDC Display:                            â”‚
â”‚  Decimal(1500000) / Decimal(10**6)                   â”‚
â”‚  â†’ Decimal('1.5')                                     â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: Arithmetic Operations                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Profit Calculation:                                  â”‚
â”‚  â”œâ”€ Gas Cost Wei:  1200000000000000 (Decimal)        â”‚
â”‚  â”œâ”€ Slippage Wei:  15000000000000000 (Decimal)       â”‚
â”‚  â””â”€ Net Wei:       Gross - Gas - Slippage           â”‚
â”‚                  = Exact arbitrary precision          â”‚
â”‚                                                         â”‚
â”‚  All operations maintain full precision               â”‚
â”‚  No intermediate rounding errors                      â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: Convert Back to Wei (Integer)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Decimal('1.5') Ã— Decimal(10**18)                    â”‚
â”‚  â†’ Decimal('1500000000000000000')                    â”‚
â”‚  â†’ int(...)                                           â”‚
â”‚  â†’ 1500000000000000000 (integer Wei)                 â”‚
â”‚                                                         â”‚
â”‚  Ready for blockchain submission                      â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“

OUTPUT: 1500000000000000000 Wei
        (Exact precision maintained)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

CONTRAST: Floating Point Pitfall

âŒ WRONG APPROACH:
  wei_str = "1500000000000000000"
  eth = float(wei_str) / 1e18
  # eth = 1.5 (appears correct)
  
  wei_back = int(eth * 1e18)
  # wei_back = 1499999999999999872 âŒ
  # PRECISION LOST! (~1 Wei off)
  
  On large trades: Losses compound to significant amounts

âœ… CORRECT APPROACH (TokenAmount):
  TokenAmount.from_wei("1500000000000000000", "ETH")
  Uses WeiConverter internally
  # Result: Exact 1500000000000000000 Wei
```

---

## 8. Test Execution Pipeline (Real API Only)

```
TEST EXECUTION (No mocks allowed!)
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEST SETUP                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  1. Load .env                                          â”‚
â”‚     â”œâ”€ DUNE_API_KEY                                   â”‚
â”‚     â”œâ”€ ALCHEMY_RPC_URL                                â”‚
â”‚     â””â”€ WALLET_PRIVATE_KEY                             â”‚
â”‚                                                         â”‚
â”‚  2. Initialize Real Clients                           â”‚
â”‚     â”œâ”€ DuneClient(DUNE_API_KEY)                      â”‚
â”‚     â”œâ”€ Web3(HTTPProvider(ALCHEMY_RPC_URL))          â”‚
â”‚     â””â”€ Account.from_key(WALLET_PRIVATE_KEY)         â”‚
â”‚                                                         â”‚
â”‚  3. Connect to Real Services                          â”‚
â”‚     â”œâ”€ Dune API (validates connection)               â”‚
â”‚     â”œâ”€ Alchemy RPC (validates chain access)          â”‚
â”‚     â””â”€ MCP Gateway (validates server connectivity)   â”‚
â”‚                                                         â”‚
â”‚  âš ï¸  NO MOCKS, NO FIXTURES, NO CONFTEST               â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DATA VALIDATION TESTS                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  test_dune_data_freshness():                          â”‚
â”‚  â”œâ”€ Execute Query 5447367 (ETH price)                â”‚
â”‚  â”œâ”€ Check: Timestamp < 5 minutes                     â”‚
â”‚  â”œâ”€ Check: Price in expected range ($1K - $10K)    â”‚
â”‚  â”œâ”€ Check: No duplicate tx_hash                      â”‚
â”‚  â””â”€ Assert: Data is fresh, not cached               â”‚
â”‚                                                         â”‚
â”‚  test_mcp_server_connectivity():                      â”‚
â”‚  â”œâ”€ POST /execute/uniswap-pools                      â”‚
â”‚  â”œâ”€ Call: get_pools()                                â”‚
â”‚  â”œâ”€ Assert: Response in < 5 seconds                 â”‚
â”‚  â””â”€ Assert: Returns valid pool data                 â”‚
â”‚                                                         â”‚
â”‚  test_precision_math_accuracy():                      â”‚
â”‚  â”œâ”€ Convert: Wei â†’ ETH â†’ Wei                         â”‚
â”‚  â”œâ”€ Input: "1500000000000000000"                    â”‚
â”‚  â”œâ”€ Assert: Output == Input (bit-exact)            â”‚
â”‚  â””â”€ Assert: No floating point errors                â”‚
â”‚                                                         â”‚
â”‚  test_wallet_balance():                              â”‚
â”‚  â”œâ”€ Query: wallet balance on chain                   â”‚
â”‚  â”œâ”€ Assert: balance > 0                             â”‚
â”‚  â””â”€ Assert: sufficient for testing                  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INTEGRATION TESTS                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  test_arbitrage_scanning():                           â”‚
â”‚  â”œâ”€ Call: ArbitrageScanner.get_cross_dex_data()   â”‚
â”‚  â”œâ”€ Validate: Data structure, required fields        â”‚
â”‚  â”œâ”€ Validate: Prices are realistic                  â”‚
â”‚  â””â”€ Assert: No duplicate opportunities               â”‚
â”‚                                                         â”‚
â”‚  test_profitability_calculation():                    â”‚
â”‚  â”œâ”€ Input: Opportunity with spread                  â”‚
â”‚  â”œâ”€ Calculate: gas, slippage, profit               â”‚
â”‚  â”œâ”€ Assert: Formula correct (spreadsheet validate)  â”‚
â”‚  â””â”€ Assert: Profit threshold properly applied       â”‚
â”‚                                                         â”‚
â”‚  test_mcp_swap_encoding():                           â”‚
â”‚  â”œâ”€ Create: Swap transaction                        â”‚
â”‚  â”œâ”€ Encode: Using ContractEncoder                  â”‚
â”‚  â”œâ”€ Validate: Encoding structure                    â”‚
â”‚  â””â”€ Assert: No "0x" padding, real encoding         â”‚
â”‚                                                         â”‚
â”‚  test_fallback_chain():                              â”‚
â”‚  â”œâ”€ Disable: Dune response                          â”‚
â”‚  â”œâ”€ Trigger: Dexscreener fallback                  â”‚
â”‚  â”œâ”€ Assert: Fallback activates                     â”‚
â”‚  â””â”€ Assert: Data received from fallback            â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TESTNET EXECUTION TESTS (Real transactions!)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  test_sepolia_swap():                                â”‚
â”‚  â”œâ”€ Execute: Real swap on Sepolia testnet           â”‚
â”‚  â”œâ”€ Input: 0.001 ETH                                â”‚
â”‚  â”œâ”€ Assert: Transaction successful                  â”‚
â”‚  â”œâ”€ Assert: Balance updated correctly               â”‚
â”‚  â””â”€ Assert: Gas fee deducted from wallet            â”‚
â”‚                                                         â”‚
â”‚  test_flashbots_bundle_simulation():                 â”‚
â”‚  â”œâ”€ Create: Bundle spec                             â”‚
â”‚  â”œâ”€ Simulate: Via Flashbots API                    â”‚
â”‚  â”œâ”€ Assert: Simulation succeeds                     â”‚
â”‚  â””â”€ Assert: Profit calculation matches simulation   â”‚
â”‚                                                         â”‚
â”‚  âš ï¸  TESTNET ONLY - Real gas costs incurred         â”‚
â”‚      (Sepolia ETH cost = minimal)                    â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESULTS REPORTING                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  pytest output:                                       â”‚
â”‚  âœ… test_dune_data_freshness                         â”‚
â”‚  âœ… test_mcp_server_connectivity                     â”‚
â”‚  âœ… test_precision_math_accuracy                     â”‚
â”‚  âœ… test_wallet_balance                              â”‚
â”‚  âœ… test_arbitrage_scanning                          â”‚
â”‚  âœ… test_profitability_calculation                   â”‚
â”‚  âœ… test_mcp_swap_encoding                           â”‚
â”‚  âœ… test_fallback_chain                              â”‚
â”‚  âœ… test_sepolia_swap                                â”‚
â”‚  âœ… test_flashbots_bundle_simulation                 â”‚
â”‚                                                         â”‚
â”‚  Coverage: Real API interactions 100%                â”‚
â”‚  Mock data: 0%                                        â”‚
â”‚  Status: âœ… ALL TESTS PASSED                         â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Summary

These diagrams show:

1. **System Architecture** - Overall structure from UI to external systems
2. **Data Flow** - Step-by-step process from startup to opportunity execution
3. **MCP Integration** - Server types and fallback chain architecture
4. **Module Dependencies** - How components relate and depend on each other
5. **Profit Calculation** - Detailed math for profitability validation
6. **Fallback Hierarchy** - Data source priority with real status (Sept 2025)
7. **Precision Math** - Why Decimal is critical for Wei conversions
8. **Test Pipeline** - Real API testing with no mocks (per CLAUDE.md rules)

The system is designed with **robustness** through multiple fallback tiers and **precision** through dedicated math libraries, following strict rules about fresh data and no caching.
